<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²¡å±±æ¡ƒå¤ªéƒä¹‹æ—… | è±ªè¯åœ–æ–‡ç‰ˆ</title>
    <!-- å¼•å…¥ React å’Œ Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å­—é«”èˆ‡è‡ªå®šç¾©æ¨£å¼ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fcfaf8;
            color: #4a4a4a;
        }
        
        .font-serif { font-family: 'Shippori Mincho', serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            overflow: hidden;
        }
        
        .dragging {
            opacity: 0.5;
            transform: scale(0.98);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 2px dashed #fecaca;
        }

        .edit-input {
            background: rgba(255,255,255,0.8);
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 4px 8px;
            width: 100%;
            transition: all 0.2s;
        }
        .edit-input:focus {
            outline: none;
            border-color: #fecaca;
            box-shadow: 0 0 0 2px rgba(254, 202, 202, 0.3);
        }
        
        .jr-badge {
            background: #15803d;
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .cost-panel {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* åœ–ç‰‡å®¹å™¨æ¨£å¼ */
        .card-image-container {
            height: 140px;
            width: 100%;
            overflow: hidden;
            position: relative;
            background-color: #f3f4f6;
        }
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .glass-card:hover .card-image {
            transform: scale(1.05);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'momo-pink': '#fecaca',
                        'momo-red': '#f43f5e',
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // è¼”åŠ©å‡½æ•¸ï¼šè‡ªå‹•ç”Ÿæˆåœ–ç‰‡ç¶²å€
        const getAutoImageUrl = (name) => {
            const cleanName = name.split(':')[0].replace(/[:\/]/g, ' ').split(' ')[0];
            return `https://loremflickr.com/400/200/japan,travel,${encodeURIComponent(cleanName)}/all?lock=${Math.floor(Math.random()*100)}`;
        };

        // é è¨­è³‡æ–™ (å·²åŠ å…¥è©³ç´°åœ°å€)
        const defaultItineraryData = [
            {
                day: 1,
                title: "æŠµé”å²¡å±±",
                subtitle: "æ¡ƒå¤ªéƒçš„æ•…é„‰",
                locations: [
                    { id: 101, time: "ä¸‹åˆ", name: "å²¡å±±æ©Ÿå ´ â†’ å²¡å±±ç«™", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæ—¥å¿œå¯º1277", type: "transport", cost: 780, jrPass: false, note: "åˆ©æœ¨æ´¥å·´å£«", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Okayama_Airport_20230812.jpg/640px-Okayama_Airport_20230812.jpg" },
                    { id: 102, time: "Check-in", name: "Regalo Hotel Okayama", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "stay", cost: 0, jrPass: false, note: "ç«™å‰ä¾¿åˆ©ä½å®¿", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Okayama_Station_East_Side.jpg/640px-Okayama_Station_East_Side.jpg" },
                    { id: 103, time: "æ™šé¤", name: "400â„ƒ PIZZA", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœã®è¡—ã‚°ãƒ¬ãƒ¼ã‚¹", type: "food", cost: 0, jrPass: false, note: "é«˜äººæ°£æŠ«è–©", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Eq_it-na_pizza-margherita_sep2005_sml.jpg/640px-Eq_it-na_pizza-margherita_sep2005_sml.jpg" },
                    { id: 104, time: "é€›è¡—", name: "å²¡å±±ç«™å‰å•†åº—è¡—", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºé§…å‰ç”º", type: "activity", cost: 0, jrPass: false, note: "æ¡è²·è£œçµ¦å“", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Okayama_Station_shopping_street.jpg/640px-Okayama_Station_shopping_street.jpg" },
                    { id: 105, time: "æ™šä¸Š", name: "è¿”å›ä½å®¿: Regalo Hotel Okayama", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "transport", cost: 0, jrPass: false, note: "æ­¥è¡Œè¿”å›", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Okayama_Station_at_night.jpg/640px-Okayama_Station_at_night.jpg" }
                ]
            },
            {
                day: 2,
                title: "å€‰æ•·ç¾è§€èˆ‡å‰å‚™æ´¥",
                subtitle: "ç™½å£åœŸè—èˆ‡å‚³èªªä¹‹åœ°",
                locations: [
                    { id: 200, time: "ä¸Šåˆ", name: "å¾ä½å®¿å‡ºç™¼", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "transport", cost: 0, jrPass: false, note: "å‰å¾€è»Šç«™", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Okayama_Station_East_Side.jpg/640px-Okayama_Station_East_Side.jpg" },
                    { id: 201, time: "ä¸Šåˆ", name: "å²¡å±± â†’ å€‰æ•·", address: "å²¡å±±çœŒå€‰æ•·å¸‚é˜¿çŸ¥1ä¸ç›®1-1", type: "transport", cost: 330, jrPass: true, note: "JR å±±é™½æœ¬ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 202, time: "åˆé¤", name: "Kappa ç‚¸è±¬æ’", address: "å²¡å±±çœŒå€‰æ•·å¸‚é˜¿çŸ¥2-17-2", type: "food", cost: 0, jrPass: false, note: "å€‰æ•·åç‰©", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/Tonkatsu_002.jpg/640px-Tonkatsu_002.jpg" },
                    { id: 203, time: "æ•£ç­–", name: "å€‰æ•·ç¾è§€åœ°å€", address: "å²¡å±±çœŒå€‰æ•·å¸‚ä¸­å¤®1-4-8", type: "activity", cost: 0, jrPass: false, note: "å°æ©‹æµæ°´", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Kurashiki_Bikan04s3200.jpg/640px-Kurashiki_Bikan04s3200.jpg" },
                    { id: 204, time: "ä¸‹åˆ", name: "å€‰æ•· â†’ å‚™å‰ä¸€å®®", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºä¸€å®®55-1", type: "transport", cost: 540, jrPass: true, note: "JR è½‰ä¹˜", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 205, time: "åƒæ‹œ", name: "å‰å‚™æ´¥ç¥ç¤¾", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºå‰å‚™æ´¥931", type: "activity", cost: 0, jrPass: false, note: "æ¡ƒå¤ªéƒå‚³èªª", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f6/Kibitsu-jinja_02.jpg/640px-Kibitsu-jinja_02.jpg" },
                    { id: 206, time: "å‚æ™š", name: "å‚™å‰ä¸€å®® â†’ å²¡å±±", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºé§…å…ƒç”º1-1", type: "transport", cost: 210, jrPass: true, note: "JR å‰å‚™ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 207, time: "æ™šä¸Š", name: "è¿”å›ä½å®¿", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "transport", cost: 0, jrPass: false, note: "æ­¥è¡Œè¿”å›", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Okayama_Station_at_night.jpg/640px-Okayama_Station_at_night.jpg" }
                ]
            },
            {
                day: 3,
                title: "ç›´å³¶è—è¡“å·¡ç¦®",
                subtitle: "ç€¨æˆ¶å…§æµ·çš„ç¾ä»£è—è¡“",
                locations: [
                    { id: 300, time: "ä¸Šåˆ", name: "å¾ä½å®¿å‡ºç™¼", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "transport", cost: 0, jrPass: false, note: "å‰å¾€è»Šç«™", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Okayama_Station_East_Side.jpg/640px-Okayama_Station_East_Side.jpg" },
                    { id: 301, time: "ä¸Šåˆ", name: "å²¡å±± â†’ å®‡é‡æ¸¯", address: "å²¡å±±çœŒç‰é‡å¸‚ç¯‰æ¸¯1-1", type: "transport", cost: 590, jrPass: true, note: "JR å®‡é‡ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 302, time: "æ¸¡è¼ª", name: "å®‡é‡ â†’ ç›´å³¶(å®®æµ¦)", address: "é¦™å·çœŒé¦™å·éƒ¡ç›´å³¶ç”ºå®®ãƒæµ¦", type: "transport", cost: 300, jrPass: false, note: "å››åœ‹æ±½èˆ¹ (Passä¸å«)", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Shikoku_Kisen_Naoshima_Ferry_Asahi.jpg/640px-Shikoku_Kisen_Naoshima_Ferry_Asahi.jpg" },
                    { id: 303, time: "åœ°æ¨™", name: "ç›´å³¶èµ¤å—ç“œ", address: "é¦™å·çœŒé¦™å·éƒ¡ç›´å³¶ç”ºå®®ãƒæµ¦æ¸¯", type: "activity", cost: 0, jrPass: false, note: "è‰é–“å½Œç”Ÿ", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Red_Pumpkin_Naoshima.jpg/640px-Red_Pumpkin_Naoshima.jpg" },
                    { id: 304, time: "æ¸¡è¼ª", name: "ç›´å³¶ â†’ å®‡é‡", address: "å²¡å±±çœŒç‰é‡å¸‚ç¯‰æ¸¯1-1", type: "transport", cost: 300, jrPass: false, note: "å›ç¨‹æ¸¡è¼ª", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Shikoku_Kisen_Naoshima_Ferry_Asahi.jpg/640px-Shikoku_Kisen_Naoshima_Ferry_Asahi.jpg" },
                    { id: 305, time: "æ™šä¸Š", name: "å®‡é‡ â†’ å²¡å±±", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºé§…å…ƒç”º1-1", type: "transport", cost: 590, jrPass: true, note: "JR å®‡é‡ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 306, time: "æ™šä¸Š", name: "è¿”å›ä½å®¿", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "transport", cost: 0, jrPass: false, note: "æ­¥è¡Œè¿”å›", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Okayama_Station_at_night.jpg/640px-Okayama_Station_at_night.jpg" }
                ]
            },
            {
                day: 4,
                title: "å…”å³¶èˆ‡å»£å³¶",
                subtitle: "æ¯›èŒ¸èŒ¸èˆ‡æ­·å²çš„ç—•è·¡",
                locations: [
                    { id: 400, time: "ä¸Šåˆ", name: "å¾ä½å®¿å‡ºç™¼", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæœ¬ç”º8-3", type: "transport", cost: 0, jrPass: false, note: "è¾¦ç†é€€æˆ¿", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Okayama_Station_East_Side.jpg/640px-Okayama_Station_East_Side.jpg" },
                    { id: 401, time: "ä¸Šåˆ", name: "å²¡å±± â†’ å»£å³¶", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºæ¾åŸç”º2-37", type: "transport", cost: 6230, jrPass: true, note: "æ–°å¹¹ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/N700_Z1_Hiroshima_20090228.jpg/640px-N700_Z1_Hiroshima_20090228.jpg" },
                    { id: 402, time: "ç§»å‹•", name: "å»£å³¶ â†’ å¿ æµ·", address: "åºƒå³¶çœŒç«¹åŸå¸‚å¿ æµ·ä¸­ç”º1-1", type: "transport", cost: 1490, jrPass: true, note: "JR å³ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/N700_Z1_Hiroshima_20090228.jpg/640px-N700_Z1_Hiroshima_20090228.jpg" },
                    { id: 403, time: "æ¸¡è¼ª", name: "å¿ æµ· â†’ å¤§ä¹…é‡å³¶", address: "åºƒå³¶çœŒç«¹åŸå¸‚å¿ æµ·ç”ºå¤§ä¹…é‡å³¶", type: "transport", cost: 370, jrPass: false, note: "å–®ç¨‹èˆ¹ç¥¨", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Shikoku_Kisen_Naoshima_Ferry_Asahi.jpg/640px-Shikoku_Kisen_Naoshima_Ferry_Asahi.jpg" },
                    { id: 404, time: "é«”é©—", name: "å¤§ä¹…é‡å³¶ (å…”å­å³¶)", address: "åºƒå³¶çœŒç«¹åŸå¸‚å¿ æµ·ç”ºå¤§ä¹…é‡å³¶", type: "activity", cost: 0, jrPass: false, note: "èˆ‡å…”å­äº’å‹•", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Okunoshima_Rabbit_2.jpg/640px-Okunoshima_Rabbit_2.jpg" },
                    { id: 405, time: "ç§»å‹•", name: "å¿ æµ· â†’ å»£å³¶", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºæ¾åŸç”º2-37", type: "transport", cost: 1490, jrPass: true, note: "JR å³ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/N700_Z1_Hiroshima_20090228.jpg/640px-N700_Z1_Hiroshima_20090228.jpg" },
                    { id: 406, time: "ä½å®¿", name: "Check-in: ORIGAMINN", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºäº¬æ©‹ç”º", type: "stay", cost: 0, jrPass: false, note: "å»£å³¶ä½å®¿", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Hiroshima_Station_South_Gate_2015.jpg/640px-Hiroshima_Station_South_Gate_2015.jpg" }
                ]
            },
            {
                day: 5,
                title: "å°¾é“èˆ‡é†ä¹‹æµ¦",
                subtitle: "è²“ä¹‹ç´°é“èˆ‡æ³¢å¦çš„å®¶",
                locations: [
                    { id: 500, time: "ä¸Šåˆ", name: "å¾ä½å®¿å‡ºç™¼", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºäº¬æ©‹ç”º", type: "transport", cost: 0, jrPass: false, note: "å‰å¾€è»Šç«™", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Hiroshima_Station_South_Gate_2015.jpg/640px-Hiroshima_Station_South_Gate_2015.jpg" },
                    { id: 501, time: "ä¸Šåˆ", name: "å»£å³¶ â†’ å°¾é“", address: "åºƒå³¶çœŒå°¾é“å¸‚æ±å¾¡æ‰€ç”º1-1", type: "transport", cost: 1500, jrPass: true, note: "JR ç§»å‹•", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 502, time: "çºœè»Š", name: "åƒå…‰å¯ºçºœè»Š", address: "åºƒå³¶çœŒå°¾é“å¸‚æ±åœŸå ‚ç”º20-1", type: "transport", cost: 500, jrPass: false, note: "å–®ç¨‹", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/Senkoji_Ropeway_02.jpg/640px-Senkoji_Ropeway_02.jpg" },
                    { id: 503, time: "åˆé¤", name: "å°¾é“æ‹‰éºµ", address: "åºƒå³¶çœŒå°¾é“å¸‚åœŸå ‚2-9-26", type: "food", cost: 0, jrPass: false, note: "å£¹ç•ªé¤¨", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dc/Onomichi_ramen.jpg/640px-Onomichi_ramen.jpg" },
                    { id: 504, time: "ç§»å‹•", name: "å°¾é“ â†’ ç¦å±±", address: "åºƒå³¶çœŒç¦å±±å¸‚ä¸‰ä¹‹ä¸¸ç”º30-1", type: "transport", cost: 420, jrPass: true, note: "JR å±±é™½æœ¬ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 505, time: "å·´å£«", name: "ç¦å±± â†’ é†ä¹‹æµ¦", address: "åºƒå³¶çœŒç¦å±±å¸‚é†ç”ºé†", type: "transport", cost: 550, jrPass: false, note: "é†éµå·´å£«", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Okaden_Bus_985_New_Aero_Star.jpg/640px-Okaden_Bus_985_New_Aero_Star.jpg" },
                    { id: 506, time: "å›ç¨‹", name: "ç¦å±± â†’ å»£å³¶", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºæ¾åŸç”º2-37", type: "transport", cost: 4000, jrPass: true, note: "æ–°å¹¹ç·š/JR", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/N700_Z1_Hiroshima_20090228.jpg/640px-N700_Z1_Hiroshima_20090228.jpg" },
                    { id: 507, time: "æ™šä¸Š", name: "è¿”å›ä½å®¿", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºäº¬æ©‹ç”º", type: "transport", cost: 0, jrPass: false, note: "ä¼‘æ¯", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Hiroshima_Station_South_Gate_2015.jpg/640px-Hiroshima_Station_South_Gate_2015.jpg" }
                ]
            },
            {
                day: 6,
                title: "å®®å³¶åš´å³¶ç¥ç¤¾",
                subtitle: "æµ·ä¸Šé³¥å±…çš„ç¥åŸŸ",
                locations: [
                    { id: 600, time: "ä¸Šåˆ", name: "å¾ä½å®¿å‡ºç™¼", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºäº¬æ©‹ç”º", type: "transport", cost: 0, jrPass: false, note: "å‰å¾€è»Šç«™", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Hiroshima_Station_South_Gate_2015.jpg/640px-Hiroshima_Station_South_Gate_2015.jpg" },
                    { id: 601, time: "ä¸Šåˆ", name: "å»£å³¶ â†’ å®®å³¶å£", address: "åºƒå³¶çœŒå»¿æ—¥å¸‚å¸‚å®®å³¶å£1-3-23", type: "transport", cost: 420, jrPass: true, note: "JR å±±é™½æœ¬ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/JR_West_KiHa_40_2000_KiBi_Line_Color.jpg/640px-JR_West_KiHa_40_2000_KiBi_Line_Color.jpg" },
                    { id: 602, time: "æ¸¡è¼ª", name: "å®®å³¶å£ â†’ å®®å³¶", address: "åºƒå³¶çœŒå»¿æ—¥å¸‚å¸‚å®®å³¶ç”º", type: "transport", cost: 180, jrPass: true, note: "JR æ¸¡è¼ª", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/JR_Miyajima_Ferry_Misen-maru_01.JPG/640px-JR_Miyajima_Ferry_Misen-maru_01.JPG" },
                    { id: 603, time: "åƒæ‹œ", name: "åš´å³¶ç¥ç¤¾", address: "åºƒå³¶çœŒå»¿æ—¥å¸‚å¸‚å®®å³¶ç”º1-1", type: "activity", cost: 300, jrPass: false, note: "æµ·ä¸Šé³¥å±…", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Itsukushima_Gate.jpg/640px-Itsukushima_Gate.jpg" },
                    { id: 604, time: "åˆé¤", name: "å®®å³¶è¡¨åƒé“å•†åº—è¡—", address: "åºƒå³¶çœŒå»¿æ—¥å¸‚å¸‚å®®å³¶ç”º", type: "food", cost: 0, jrPass: false, note: "ç‰¡è £ã€ç´…è‘‰é¥…é ­", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Kaki_fry.jpg/640px-Kaki_fry.jpg" },
                    { id: 605, time: "å›ç¨‹", name: "å®®å³¶ â†’ å»£å³¶", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºæ¾åŸç”º2-37", type: "transport", cost: 600, jrPass: true, note: "æ¸¡è¼ª+JR", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/JR_Miyajima_Ferry_Misen-maru_01.JPG/640px-JR_Miyajima_Ferry_Misen-maru_01.JPG" },
                    { id: 606, time: "æ™šä¸Š", name: "è¿”å›ä½å®¿", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºäº¬æ©‹ç”º", type: "transport", cost: 0, jrPass: false, note: "ä¼‘æ¯", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Hiroshima_Station_South_Gate_2015.jpg/640px-Hiroshima_Station_South_Gate_2015.jpg" }
                ]
            },
            {
                day: 7,
                title: "å²¡å±±åŸèˆ‡è³¦æ­¸",
                subtitle: "é»‘è‰²çƒåŸèˆ‡æœ€å¾Œæ¡è²·",
                locations: [
                    { id: 700, time: "ä¸Šåˆ", name: "å¾ä½å®¿å‡ºç™¼", address: "åºƒå³¶çœŒåºƒå³¶å¸‚å—åŒºäº¬æ©‹ç”º", type: "transport", cost: 0, jrPass: false, note: "è¾¦ç†é€€æˆ¿", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Hiroshima_Station_South_Gate_2015.jpg/640px-Hiroshima_Station_South_Gate_2015.jpg" },
                    { id: 701, time: "ä¸Šåˆ", name: "å»£å³¶ â†’ å²¡å±±", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºé§…å…ƒç”º1-1", type: "transport", cost: 6230, jrPass: true, note: "æ–°å¹¹ç·š", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/N700_Z1_Hiroshima_20090228.jpg/640px-N700_Z1_Hiroshima_20090228.jpg" },
                    { id: 702, time: "æ™¯é»", name: "å²¡å±±åŸ & å¾Œæ¨‚åœ’", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºä¸¸ã®å†…2-3-1", type: "activity", cost: 400, jrPass: false, note: "æ—¥æœ¬ååœ’", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Okayama_Castle_01.jpg/800px-Okayama_Castle_01.jpg" },
                    { id: 703, time: "å·´å£«", name: "å²¡å±±ç«™ â†’ æ©Ÿå ´", address: "å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºæ—¥å¿œå¯º1277", type: "transport", cost: 780, jrPass: false, note: "åˆ©æœ¨æ´¥å·´å£«", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Okaden_Bus_985_New_Aero_Star.jpg/640px-Okaden_Bus_985_New_Aero_Star.jpg" }
                ]
            }
        ];

        // åœ–ç¤ºçµ„ä»¶
        const Icon = ({ type }) => {
            const icons = { transport: "ğŸš„", food: "ğŸœ", activity: "â›©ï¸", stay: "ğŸ›ï¸", relax: "â™¨ï¸" };
            const colors = {
                transport: "bg-gray-100 text-gray-600",
                food: "bg-orange-100 text-orange-500",
                activity: "bg-momo-pink text-momo-red",
                stay: "bg-indigo-100 text-indigo-500",
                relax: "bg-teal-100 text-teal-600"
            };
            return (
                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl shrink-0 ${colors[type] || colors.activity} shadow-sm border border-white/50 bg-white`}>
                    {icons[type] || icons.activity}
                </div>
            );
        };

        // è¡Œç¨‹å¡ç‰‡
        const LocationCard = ({ 
            item, index, onUpdate, onDelete, onDuplicate, isLast,
            onDragStart, onDragEnter, onDragEnd 
        }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editData, setEditData] = useState({ ...item });

            const displayImage = item.image || getAutoImageUrl(item.name);

            const handleSave = () => {
                const finalData = { ...editData, cost: parseInt(editData.cost) || 0 };
                if (!finalData.image) finalData.image = ""; 
                onUpdate(index, finalData);
                setIsEditing(false);
            };

            const handleChange = (e) => {
                const { name, value, type, checked } = e.target;
                setEditData(prev => ({ 
                    ...prev, 
                    [name]: type === 'checkbox' ? checked : value 
                }));
            };

            const openGoogleImageSearch = () => {
                const query = encodeURIComponent(editData.name + " åœ–ç‰‡");
                window.open(`https://www.google.com/search?tbm=isch&q=${query}`, '_blank');
            };

            if (isEditing) {
                return (
                    <div className="relative pl-14 mb-4 fade-in z-20">
                        <div className="absolute left-0 top-0 w-10 flex justify-center">
                             <div className="z-10 bg-fcfaf8 p-1"><Icon type={editData.type} /></div>
                        </div>
                        <div className="glass-card p-4 rounded-xl border-l-4 border-l-stone-400 bg-white shadow-xl">
                            <div className="grid grid-cols-2 gap-2 mb-3">
                                <input name="time" value={editData.time} onChange={handleChange} placeholder="æ™‚é–“" className="edit-input text-xs font-bold" />
                                <select name="type" value={editData.type} onChange={handleChange} className="edit-input text-xs">
                                    <option value="transport">ğŸš„ äº¤é€š</option>
                                    <option value="food">ğŸœ ç¾é£Ÿ</option>
                                    <option value="activity">â›©ï¸ æ™¯é»</option>
                                    <option value="stay">ğŸ›ï¸ ä½å®¿</option>
                                    <option value="relax">â™¨ï¸ æ”¾é¬†</option>
                                </select>
                            </div>
                            <input name="name" value={editData.name} onChange={handleChange} placeholder="åœ°é»åç¨±" className="edit-input font-bold text-lg mb-2" autoFocus />
                            
                            {/* åœ°å€ç·¨è¼¯æ¬„ä½ */}
                            <div className="mb-2">
                                <label className="text-[10px] text-gray-400 block mb-1">ğŸ“ è©³ç´°åœ°å€</label>
                                <input name="address" value={editData.address || ''} onChange={handleChange} placeholder="è¼¸å…¥åœ°å€..." className="edit-input text-xs text-stone-600" />
                            </div>

                            <div className="mb-2">
                                <div className="flex justify-between items-center mb-1">
                                    <label className="text-[10px] text-gray-400">åœ–ç‰‡ç¶²å€ (å¯ç•™ç©º)</label>
                                    <button onClick={openGoogleImageSearch} className="text-[10px] text-blue-500 hover:underline flex items-center gap-1">
                                        ğŸ” æœå°‹åœ–ç‰‡
                                    </button>
                                </div>
                                <input name="image" value={editData.image || ''} onChange={handleChange} placeholder="https://..." className="edit-input text-xs text-gray-600" />
                            </div>

                            <div className="grid grid-cols-2 gap-2 mb-2 bg-gray-50 p-2 rounded-lg">
                                <div className="relative">
                                    <span className="absolute left-2 top-1.5 text-gray-400 text-xs">Â¥</span>
                                    <input name="cost" type="number" value={editData.cost} onChange={handleChange} placeholder="0" className="edit-input pl-5 text-sm font-mono" />
                                </div>
                                <div className="flex items-center">
                                    <label className="flex items-center space-x-2 text-sm text-gray-600 cursor-pointer select-none">
                                        <input type="checkbox" name="jrPass" checked={editData.jrPass} onChange={handleChange} className="w-4 h-4 text-green-600 rounded focus:ring-green-500 border-gray-300" />
                                        <span>JR Pass é©ç”¨</span>
                                    </label>
                                </div>
                            </div>
                            
                            <input name="note" value={editData.note} onChange={handleChange} placeholder="å‚™è¨»" className="edit-input text-sm mt-1" />
                            
                            <div className="flex justify-end gap-2 mt-3 pt-2 border-t border-gray-100">
                                <button onClick={() => setIsEditing(false)} className="px-3 py-1 text-xs text-gray-500 hover:bg-gray-100 rounded">å–æ¶ˆ</button>
                                <button onClick={handleSave} className="px-4 py-1 bg-stone-800 text-white text-xs rounded hover:bg-black">å„²å­˜</button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div 
                    draggable
                    onDragStart={(e) => onDragStart(e, index)}
                    onDragEnter={(e) => onDragEnter(e, index)}
                    onDragEnd={onDragEnd}
                    onDragOver={(e) => e.preventDefault()}
                    className="relative pl-14 group cursor-move transition-transform duration-200"
                    style={{ animationDelay: `${index * 50}ms` }}
                >
                    {!isLast && <div className="absolute left-5 top-10 bottom-0 w-0.5 bg-stone-200 pointer-events-none"></div>}
                    <div className="absolute left-0 top-0 w-10 flex justify-center pointer-events-none h-full">
                        <div className="z-10 bg-fcfaf8 p-1 sticky top-20"><Icon type={item.type} /></div>
                    </div>

                    <div className={`glass-card rounded-2xl relative transition-all hover:translate-x-1 active:scale-[0.98]
                        ${item.type === 'transport' ? 'border-l-4 border-l-stone-400 bg-stone-50/60' : 'border-l-4 border-l-momo-pink'}`}>
                        
                        {/* åœ–ç‰‡å€åŸŸ */}
                        <div className="card-image-container group-hover:h-[160px] transition-all duration-500">
                            <img src={displayImage} alt={item.name} className="card-image" loading="lazy" onError={(e) => e.target.src='https://loremflickr.com/400/200/japan,travel,scenery/all'} />
                            <div className="absolute inset-0 bg-gradient-to-t from-white via-white/10 to-transparent opacity-90"></div>
                        </div>

                        {/* å…§å®¹å€åŸŸ */}
                        <div className="p-4 pt-2 relative -mt-8">
                            {/* å‹•ä½œæŒ‰éˆ• */}
                            <div className="absolute top-0 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 rounded-full p-1 shadow-sm backdrop-blur-sm z-10">
                                <div className="w-8 h-8 flex items-center justify-center text-stone-300 cursor-move" title="æ‹–æ›³æ’åº"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 8h16M4 16h16"></path></svg></div>
                                <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.address || item.name)}`} target="_blank" rel="noopener noreferrer" className="w-8 h-8 rounded-full hover:bg-blue-50 text-stone-400 hover:text-blue-600 flex items-center justify-center" title="å°èˆª"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg></a>
                                <button onClick={() => onDuplicate(index)} className="w-8 h-8 rounded-full hover:bg-green-50 text-stone-400 hover:text-green-600 flex items-center justify-center" title="è¤‡è£½"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button>
                                <button onClick={() => setIsEditing(true)} className="w-8 h-8 rounded-full hover:bg-amber-50 text-stone-400 hover:text-amber-600 flex items-center justify-center" title="ç·¨è¼¯"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></button>
                                <button onClick={() => onDelete(index)} className="w-8 h-8 rounded-full hover:bg-red-50 text-stone-400 hover:text-red-600 flex items-center justify-center" title="åˆªé™¤"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                            </div>

                            <div className="flex justify-between items-start mb-1 pr-2 relative z-0">
                                <span className={`text-xs font-bold px-2 py-0.5 rounded ${item.type === 'transport' ? 'bg-stone-200 text-stone-600' : 'bg-rose-100 text-rose-600'}`}>
                                    {item.time}
                                </span>
                                <div className="flex flex-col items-end">
                                    {item.jrPass && (
                                        <span className="jr-badge mb-0.5">
                                            <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path></svg>
                                            JR PASS
                                        </span>
                                    )}
                                    {item.cost > 0 && (
                                        <span className={`text-xs font-mono font-bold ${item.jrPass ? 'text-gray-400 line-through' : 'text-stone-600'}`}>
                                            Â¥{item.cost.toLocaleString()}
                                        </span>
                                    )}
                                </div>
                            </div>
                            
                            <h3 className="text-lg font-bold text-stone-800 leading-tight mb-1 pr-12 select-none relative z-0">
                                {item.name}
                            </h3>
                            
                            {item.address && (
                                <p className="text-xs text-stone-400 mb-1 flex items-center gap-1">
                                    ğŸ“ {item.address}
                                </p>
                            )}
                            
                            {item.note && (
                                <p className="text-sm text-stone-500 flex items-center gap-1 select-none relative z-0">
                                    {item.type === 'transport' ? 'ğŸ«' : 'ğŸ’¡'} {item.note}
                                </p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeDay, setActiveDay] = useState(1);
            const [itinerary, setItinerary] = useState(defaultItineraryData);
            const [loaded, setLoaded] = useState(false);
            const [isPanelExpanded, setIsPanelExpanded] = useState(true);
            
            const dragItem = useRef();
            const dragOverItem = useRef();
            const fileInputRef = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('myOkamotoTrip_Img');
                if (saved) {
                    try { 
                        const parsed = JSON.parse(saved);
                        // æª¢æŸ¥èˆŠè³‡æ–™æ ¼å¼ï¼Œè‹¥ç„¡åœ–ç‰‡æˆ–åœ°å€æ¬„ä½å‰‡è‡ªå‹•è£œä¸Š
                        const migrated = parsed.map((day, dIdx) => ({
                            ...day,
                            locations: day.locations.map((loc, lIdx) => ({
                                ...loc,
                                image: loc.image || defaultItineraryData[dIdx]?.locations[lIdx]?.image || getAutoImageUrl(loc.name),
                                address: loc.address || defaultItineraryData[dIdx]?.locations[lIdx]?.address || ""
                            }))
                        }));
                        setItinerary(migrated); 
                    } catch(e) {}
                } else {
                    setItinerary(defaultItineraryData);
                }
                setLoaded(true);
            }, []);

            useEffect(() => {
                if(loaded) localStorage.setItem('myOkamotoTrip_Img', JSON.stringify(itinerary));
            }, [itinerary, loaded]);

            const currentDayIndex = itinerary.findIndex(d => d.day === activeDay);
            const currentDayData = itinerary[currentDayIndex];

            // çµ±è¨ˆ
            const stats = useMemo(() => {
                let totalCash = 0;
                let totalSaved = 0;
                let dailyCash = 0;

                itinerary.forEach(day => {
                    day.locations.forEach(item => {
                        if (item.type === 'transport') {
                            const cost = parseInt(item.cost) || 0;
                            if (item.jrPass) {
                                totalSaved += cost;
                            } else {
                                totalCash += cost;
                                if (day.day === activeDay) {
                                    dailyCash += cost;
                                }
                            }
                        }
                    });
                });

                return { totalCash, totalSaved, dailyCash };
            }, [itinerary, activeDay]);

            // CRUD Handlers
            const updateLocations = (newLocations) => {
                const newItinerary = [...itinerary];
                newItinerary[currentDayIndex] = { ...currentDayData, locations: newLocations };
                setItinerary(newItinerary);
            };
            const handleUpdateItem = (idx, item) => {
                const newLocs = [...currentDayData.locations];
                newLocs[idx] = item;
                updateLocations(newLocs);
            };
            const handleDeleteItem = (idx) => {
                const newLocs = currentDayData.locations.filter((_, i) => i !== idx);
                updateLocations(newLocs);
            };
            const handleDuplicateItem = (idx) => {
                const item = { ...currentDayData.locations[idx], id: Date.now() };
                const newLocs = [...currentDayData.locations];
                newLocs.splice(idx + 1, 0, item);
                updateLocations(newLocs);
            };
            const handleAddItem = () => {
                const newName = "æ–°è¡Œç¨‹";
                updateLocations([...currentDayData.locations, { 
                    id: Date.now(), time: "æ™‚é–“", name: newName, address: "", type: "activity", cost: 0, jrPass: false, note: "", 
                    image: getAutoImageUrl(newName)
                }]);
            };

            // æª”æ¡ˆåŒ¯å‡º (ä¸‹è¼‰/å„²å­˜)
            const handleExport = async () => {
                const dataStr = JSON.stringify(itinerary, null, 2);
                
                if ('showSaveFilePicker' in window) {
                    try {
                        const handle = await window.showSaveFilePicker({
                            suggestedName: `okayama_trip_${new Date().toISOString().slice(0,10)}.json`,
                            types: [{
                                description: 'JSON Files',
                                accept: { 'application/json': ['.json'] },
                            }],
                        });
                        const writable = await handle.createWritable();
                        await writable.write(dataStr);
                        await writable.close();
                        alert("æª”æ¡ˆå„²å­˜æˆåŠŸï¼");
                        return;
                    } catch (err) {
                        if (err.name !== 'AbortError') console.error('SaveFilePicker failed:', err);
                        else return;
                    }
                }

                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `okayama_trip_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // æª”æ¡ˆåŒ¯å…¥ (è®€å–)
            const handleImportClick = () => {
                fileInputRef.current.click();
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const parsed = JSON.parse(event.target.result);
                        if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].locations) {
                            if(confirm("ç¢ºå®šè¦è®€å–æ­¤æª”æ¡ˆå—ï¼Ÿç›®å‰çš„è¡Œç¨‹å°‡è¢«è¦†è“‹ã€‚")) {
                                setItinerary(parsed);
                                alert("è¡Œç¨‹è®€å–æˆåŠŸï¼");
                            }
                        } else {
                            alert("æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ç¢ºèªé€™æ˜¯æœ¬ç³»çµ±åŒ¯å‡ºçš„ JSON æª”ã€‚");
                        }
                    } catch (err) {
                        alert("ç„¡æ³•è®€å–æª”æ¡ˆï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼ã€‚");
                    }
                    e.target.value = null; // Reset input
                };
                reader.readAsText(file);
            };

            // Drag & Drop
            const handleDragStart = (e, position) => {
                dragItem.current = position;
                e.target.classList.add('dragging');
            };
            const handleDragEnter = (e, position) => {
                dragOverItem.current = position;
                if (dragItem.current !== null && dragItem.current !== position) {
                    const copyListItems = [...currentDayData.locations];
                    const dragItemContent = copyListItems[dragItem.current];
                    copyListItems.splice(dragItem.current, 1);
                    copyListItems.splice(position, 0, dragItemContent);
                    dragItem.current = position;
                    updateLocations(copyListItems);
                }
            };
            const handleDragEnd = (e) => {
                dragItem.current = null;
                dragOverItem.current = null;
                e.target.classList.remove('dragging');
            };

            if (!loaded) return null;

            return (
                <div className="min-h-screen pb-40 relative">
                    <header className="bg-stone-900 text-white py-8 px-6 text-center relative overflow-hidden flex flex-col items-center">
                        <div className="absolute inset-0 opacity-10" style={{backgroundImage: "radial-gradient(#ffffff 1px, transparent 1px)", backgroundSize: "20px 20px"}}></div>
                        <div className="relative z-10 w-full max-w-4xl flex justify-between items-start mb-4">
                             {/* æ¨™é¡Œå€ */}
                            <div className="text-left">
                                <h1 className="text-2xl md:text-3xl font-serif font-bold text-momo-pink mb-1">å²¡å±±æ¡ƒå¤ªéƒä¹‹æ—…</h1>
                                <p className="text-stone-400 text-xs tracking-widest">SAVE & EXPORT EDITION</p>
                            </div>

                            {/* åŠŸèƒ½æŒ‰éˆ•å€ */}
                            <div className="flex gap-2">
                                <button onClick={handleExport} className="flex items-center gap-1 bg-stone-700 hover:bg-stone-600 px-3 py-1.5 rounded-lg text-xs transition-colors" title="åŒ¯å‡ºè¡Œç¨‹ (ä¸‹è¼‰)">
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                    <span className="hidden md:inline">åŒ¯å‡º</span>
                                </button>
                                <button onClick={handleImportClick} className="flex items-center gap-1 bg-stone-700 hover:bg-stone-600 px-3 py-1.5 rounded-lg text-xs transition-colors" title="åŒ¯å…¥è¡Œç¨‹ (è®€å–)">
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                    <span className="hidden md:inline">åŒ¯å…¥</span>
                                </button>
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} accept=".json" className="hidden" />
                                
                                <button onClick={() => {if(window.confirm("é‡ç½®å°‡æ¸…é™¤æ‰€æœ‰ä¿®æ”¹ï¼Ÿ")) { localStorage.removeItem('myOkamotoTrip_Img'); window.location.reload(); }}} 
                                    className="flex items-center gap-1 bg-stone-800 hover:bg-red-900/50 text-stone-400 hover:text-red-300 px-3 py-1.5 rounded-lg text-xs transition-colors" title="é‡ç½®">
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-3xl mx-auto px-4 mt-6">
                        <div className="flex gap-2 overflow-x-auto pb-4 scrollbar-hide sticky top-2 z-30 py-2 bg-gradient-to-b from-[#fcfaf8] to-transparent">
                            {itinerary.map((data) => (
                                <button key={data.day} onClick={() => setActiveDay(data.day)}
                                    className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all shadow-sm
                                        ${activeDay === data.day ? 'bg-stone-800 text-white transform scale-105' : 'bg-white text-stone-400 border border-stone-200'}`}>
                                    Day {data.day}
                                </button>
                            ))}
                        </div>

                        <div key={activeDay} className="fade-in mt-2 pb-12">
                            <div className="mb-6 px-2">
                                <h2 className="text-2xl font-serif font-bold text-stone-800 flex items-center gap-2">
                                    <span className="text-momo-red">Day {currentDayData.day}</span>
                                    {currentDayData.title}
                                </h2>
                                <p className="text-stone-500 text-sm mt-1 ml-1">{currentDayData.subtitle}</p>
                            </div>

                            <div className="space-y-6 relative pl-2">
                                <div className="absolute left-7 top-4 bottom-4 w-0.5 bg-stone-200"></div>
                                {currentDayData.locations.map((item, index) => (
                                    <LocationCard 
                                        key={item.id} item={item} index={index}
                                        isLast={index === currentDayData.locations.length - 1}
                                        onUpdate={handleUpdateItem} onDelete={handleDeleteItem} 
                                        onDuplicate={handleDuplicateItem}
                                        onDragStart={handleDragStart} onDragEnter={handleDragEnter} onDragEnd={handleDragEnd}
                                    />
                                ))}
                                <button onClick={handleAddItem} className="ml-14 w-[calc(100%-3.5rem)] py-3 border-2 border-dashed border-stone-300 rounded-xl text-stone-400 hover:border-momo-pink hover:text-momo-red hover:bg-rose-50 transition-colors font-bold text-sm">
                                    + æ–°å¢è¡Œç¨‹
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* æ‡¸æµ®è²»ç”¨çµ±è¨ˆé¢æ¿ (å¯æ”¶ç´) */}
                    <div className={`fixed bottom-6 right-4 left-4 md:left-auto md:w-80 cost-panel rounded-2xl transition-all duration-300 z-40 overflow-hidden ${isPanelExpanded ? 'p-4' : 'p-3'}`}>
                        <div 
                            className="flex justify-between items-center cursor-pointer"
                            onClick={() => setIsPanelExpanded(!isPanelExpanded)}
                        >
                            <div className="flex items-center gap-2">
                                <span className="text-stone-300 text-xs uppercase tracking-wider font-bold">
                                    {isPanelExpanded ? "è²»ç”¨çµ±è¨ˆ" : "Total Payment"}
                                </span>
                                {!isPanelExpanded && (
                                    <span className="text-momo-pink font-mono font-bold">
                                        Â¥{stats.totalCash.toLocaleString()}
                                    </span>
                                )}
                            </div>
                            
                            <button className="text-stone-400 hover:text-white transition-colors">
                                <svg 
                                    className={`w-5 h-5 transform transition-transform ${isPanelExpanded ? 'rotate-180' : ''}`} 
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                >
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                        </div>

                        {isPanelExpanded && (
                            <div className="mt-3 pt-3 border-t border-white/10 flex flex-col gap-2 fade-in">
                                 <div className="flex justify-between items-center">
                                    <span className="text-gray-300 text-sm">æœ¬æ—¥è‡ªä»˜äº¤é€šè²»</span>
                                    <span className="text-lg font-mono font-bold text-white">Â¥{stats.dailyCash.toLocaleString()}</span>
                                </div>
                                <div className="grid grid-cols-2 gap-4 pt-1">
                                    <div>
                                        <p className="text-[10px] text-gray-400 uppercase tracking-wider">Total Payment</p>
                                        <p className="text-xl font-mono font-bold text-momo-pink">Â¥{stats.totalCash.toLocaleString()}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-[10px] text-gray-400 uppercase tracking-wider">JR Pass Saved</p>
                                        <p className="text-xl font-mono font-bold text-green-400">Â¥{stats.totalSaved.toLocaleString()}</p>
                                    </div>
                                </div>
                                {stats.totalSaved > 23000 && (
                                    <div className="text-center text-[10px] text-green-300 bg-green-900/30 rounded py-1 animate-pulse mt-1">
                                        âœ¨ æ­å–œï¼JR Pass å·²å›æœ¬ (ç¥¨åƒ¹ Â¥23,000)
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>